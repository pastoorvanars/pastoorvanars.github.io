<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta property="og:title" content="Pastoor van Ars gastenboek" />
    <meta property="og:description" content="Lees en deel persoonlijke ervaringen van onze bezoekers." />
    <meta property="og:image" content="https://test.pastoorvanarskijkduin.nl/images/link_preview.jpg" />
    <meta property="og:url" content="https://test.pastoorvanarskijkduin.nl/guestbook.html" />
    <meta property="og:type" content="website" />

    <link rel="stylesheet" href="styles.css" />
    <title id="content-title">Pastoor van Ars gastenboek</title>
    <script src="script.js"></script>
    <script async src="https://tally.so/widgets/embed.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            /* guestbook loading */

            const params = new URLSearchParams(window.location.search);
            const highlightId = params.get("id");

            fetch("guestbook.json")
                .then((response) => response.json())
                .then((data) => {
                    const guestbookDiv = document.getElementById("guestbook");


                    // Highlighted entry first
                    const highlightedEntry = data.find(entry => entry.Id === highlightId);
                    if (highlightedEntry) {
                        const highlightedDiv = createEntryDiv(highlightedEntry, true);
                        guestbookDiv.appendChild(highlightedDiv);
                    }

                    // Remaining entries
                    data
                        .filter(entry => entry.Id !== highlightId)
                        .forEach(entry => {
                            const entryDiv = createEntryDiv(entry, false);
                            guestbookDiv.appendChild(entryDiv);
                        });
                });
        });

        function createEntryDiv(entry, isHighlighted) {
            const entryDiv = document.createElement("div");
            const textDiv = document.createElement("div");
            textDiv.classList.add("review-content");

            entryDiv.classList.add("review");
            if (isHighlighted) {
                entryDiv.classList.add("highlighted-review");
            }

            const nameElement = document.createElement("h3");
            nameElement.classList.add("review-name");

            if (entry.URL) {
                const link = document.createElement("a");
                link.href = entry.URL;
                link.textContent = entry.Name;
                link.target = "_blank";
                link.classList.add("review-link");
                nameElement.appendChild(link);
            } else {
                nameElement.textContent = entry.Name;
            }

            const dateElement = document.createElement("p");
            dateElement.classList.add("review-date");
            dateElement.textContent = new Date(entry.Date).toLocaleDateString();

            const commentElement = document.createElement("p");
            commentElement.classList.add("review-comment");
            commentElement.textContent = entry.Description;

            textDiv.appendChild(nameElement);
            textDiv.appendChild(dateElement);
            textDiv.appendChild(commentElement);

            if (entry.URL && entry.URL.includes("linkedin.com/in/") && isHighlighted) {
                const pageUrl = `https://test.pastoorvanarskijkduin.nl/guestbook.html?id=${entry.Id}`;
                const shareUrl = `https://www.linkedin.com/shareArticle/?mini=true&url=${encodeURIComponent(pageUrl)}`;

                const shareLink = document.createElement("a");
                shareLink.href = shareUrl;
                shareLink.textContent = "Deel op LinkedIn";
                shareLink.target = "_blank";
                shareLink.classList.add("linkedin-share-button");

                textDiv.appendChild(shareLink);
            }
            entryDiv.appendChild(textDiv);

            if (entry.Thumbnail) {
                const imgElement = document.createElement("img");

                imgElement.src = entry.Thumbnail;
                imgElement.alt = entry.Name;
                imgElement.className = "thumbnail";

                // Add click event to open full image in modal
                imgElement.addEventListener("click", () => {
                    openImageModal(entry.Image);
                });

                entryDiv.appendChild(imgElement);
            }
            return entryDiv;
        }

        function openImageModal(imageSrc) {
            const modal = document.createElement("div");
            modal.className = "image-modal";
            //modal.title = "Klik om te sluiten";

            const fullImage = document.createElement("img");
            fullImage.src = imageSrc;
            fullImage.className = "modal-image";

            modal.appendChild(fullImage);
            document.body.appendChild(modal);

            // Close modal on click
            modal.addEventListener("click", () => {
                document.body.removeChild(modal);
            });
        }
    </script>
</head>

<body class="content-page">
    <div class="language-toggle">
        <img src="images/nl-flag.svg" alt="Dutch" id="lang-nl" class="lang-toggle" data-lang="nl" />
        <img src="images/en-flag.svg" alt="English" id="lang-en" class="lang-toggle" data-lang="en" />
    </div>
    <a href="index.html" class="back-arrow" id="back-link">&#8592; Back</a>
    <div class="content">
        <h1 id="content-header">Content Title</h1>
        <p id="content-text">This is the content for the selected item.</p>
    </div>
    <div class="content">
        <div class="reviews-container" id="guestbook"></div>
    </div>
</body>

</html>